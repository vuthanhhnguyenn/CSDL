<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Quiz Cơ sở dữ liệu</title>
<style>
  :root {
    --bg: #0b1220;
    --card: #111a2e;
    --text: #e8eefc;
    --muted: #a7b4d6;
    --border: rgba(255,255,255,.14);
    --good: #1db954;
    --bad: #ff4d4f;
    --btn: #1f2a44;
  }
  body {
    margin: 0; background: var(--bg); color: var(--text);
    font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Helvetica Neue", sans-serif;
  }
  header {
    position: sticky; top: 0; z-index: 10;
    background: linear-gradient(180deg, rgba(11,18,32,.95), rgba(11,18,32,.75));
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
  }
  .wrap { max-width: 980px; margin: 0 auto; padding: 18px 14px; }
  h1 { margin: 0; font-size: 22px; }
  .sub { margin-top: 8px; color: var(--muted); font-size: 14px; line-height: 1.35; }
  .toolbar {
    display: flex; flex-wrap: wrap; gap: 10px; align-items: center;
    margin-top: 12px;
  }
  select, button {
    background: var(--btn); color: var(--text);
    border: 1px solid var(--border);
    padding: 10px 12px; border-radius: 12px; font-size: 14px;
  }
  button { cursor: pointer; }
  button:hover { filter: brightness(1.08); }
  .score {
    margin-left: auto; color: var(--muted); font-size: 14px;
  }
  .q {
    background: var(--card); border: 1px solid var(--border);
    border-radius: 16px; padding: 14px 14px 12px; margin: 14px 0;
    box-shadow: 0 8px 20px rgba(0,0,0,.25);
  }
  .qhead {
    display:flex; gap:10px; align-items: baseline; justify-content: space-between;
    margin-bottom: 10px;
  }
  .qid { color: var(--muted); font-size: 13px; }
  .sectionTag {
    color: var(--muted); font-size: 12px; border: 1px solid var(--border);
    padding: 4px 8px; border-radius: 999px;
  }
  .stem { font-size: 15px; line-height: 1.35; margin-bottom: 8px; }
  .desc { color: var(--muted); font-size: 14px; line-height: 1.35; margin: 8px 0 4px; }
  .code {
    background: rgba(0,0,0,.35); border: 1px solid var(--border);
    border-radius: 12px; padding: 10px; overflow: auto;
    margin: 10px 0;
  }
  .code code { color: #dbe7ff; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size: 13px; }
  .opts label {
    display:block; padding: 10px 10px; border-radius: 12px;
    border: 1px solid rgba(255,255,255,.10); margin: 8px 0;
    cursor: pointer;
  }
  .opts input { margin-right: 10px; }
  .opts label:hover { border-color: rgba(255,255,255,.24); }
  textarea {
    width: 100%; min-height: 110px; resize: vertical;
    background: rgba(0,0,0,.25); color: var(--text);
    border: 1px solid var(--border); border-radius: 12px;
    padding: 10px; font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    font-size: 13px;
  }
  .actions { display:flex; flex-wrap: wrap; gap: 10px; margin-top: 10px; align-items:center; }
  .fb { margin-top: 8px; font-size: 14px; line-height: 1.35; }
  .right { border-color: rgba(29,185,84,.55); }
  .wrong { border-color: rgba(255,77,79,.55); }
  .good { color: var(--good); }
  .bad { color: var(--bad); }
  footer { color: var(--muted); padding: 18px 0 30px; }
</style>
</head>
<body>
<header>
  <div class="wrap">
    <h1>Quiz Cơ sở dữ liệu</h1>
    <div class="sub">
      Chọn đáp án → bấm <b>Kiểm tra</b> để biết đúng/sai. Có thể lọc theo phần ở dropdown.
      <br/>Gợi ý: Với câu dạng SQL/tự luận, bạn có thể dán câu trả lời vào ô và bấm kiểm tra (so khớp theo “đáp án mẫu”).
    </div>
    <div class="toolbar">
      <select id="sectionFilter">
        <option value="__all__">Tất cả phần</option>
        <option value="Lược đồ E-R">Lược đồ E-R</option><option value="Mô hình dữ liệu quan hệ">Mô hình dữ liệu quan hệ</option><option value="Ngôn ngữ truy vấn cấu trúc SQL">Ngôn ngữ truy vấn cấu trúc SQL</option><option value="Đại số quan hệ">Đại số quan hệ</option><option value="Phụ thuộc hàm, chuẩn hóa">Phụ thuộc hàm, chuẩn hóa</option>
      </select>
      <button id="gradeAll">Chấm tất cả</button>
      <button id="resetAll">Làm lại</button>
      <div class="score" id="scoreBox">Điểm: 0/0</div>
    </div>
  </div>
</header>

<div class="wrap" id="root"></div>

<footer class="wrap">
  Tip: File này chạy offline (mở bằng Chrome/Edge). Nếu bạn muốn “random thứ tự câu” hoặc “random thứ tự đáp án”, nhắn mình là mình thêm nút shuffle.
</footer>

<script>
const QUESTIONS = [{"id": 1, "section": "Lược đồ E-R", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 1: Trong sơ đồ quan hệ thực thể, các thuộc tính được thể hiện bằng:</b></div>", "options": ["A. Hình oval", "B. Hình chữ nhật", "C. Hình thoi", "D. Hình vuông"], "answerIndex": 0, "answerText": ""}, {"id": 2, "section": "Lược đồ E-R", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 2: Trong sơ đồ quan hệ thực thể, quan hệ được thể hiện bằng:</b></div>", "options": ["A. Hình thoi", "B. Hình tròn", "C. Hình chữ nhật", "D. Hình oval"], "answerIndex": 0, "answerText": ""}, {"id": 3, "section": "Lược đồ E-R", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 3. Trong lược đồ quan hệ thực thể, thuộc tính có thể đặt ở đâu?</b></div>", "options": ["A. Có thể đặt ở các thực thể hoặc các quan hệ", "B. Chỉ có thể đặt ở các quan hệ", "C. Chỉ có thể đặt ở các thực thể", "D. Có thể đặt ở các thực thể, các quan hệ hoặc các thuộc tính khóa"], "answerIndex": 0, "answerText": ""}, {"id": 4, "section": "Lược đồ E-R", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 4: Vì sao nên sử dụng kiểu dữ liệu thích hợp cho các thuộc tính?</b></div>", "options": ["A. Vì kiểu dữ liệu qui định miền giá trị hợp lệ", "B. Vì kiểu dữ liệu của thuộc tính cho phép điều khiển định dạng của các giá trị", "C. Vì kiểu dữ liệu bảo vệ không cho phép lặp", "D. Vì kiểu dữ liệu bảo vệ không cho phép giá trị NULL"], "answerIndex": 0, "answerText": ""}, {"id": 5, "section": "Lược đồ E-R", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 5. Phát biểu nào dưới đây là sai khi nói về khái niệm khóa và siêu khóa của quan hệ R?</b></div>", "options": ["A. Một khóa có thể không phải là siêu khóa", "B. Hai siêu khóa có thể có số lượng thuộc tính khác nhau.", "C. Một siêu khóa với số lượng tối thiểu các thuộc tính sẽ trở thành khóa", "D. Một siêu khóa có thể không phải là khóa"], "answerIndex": 0, "answerText": ""}, {"id": 6, "section": "Lược đồ E-R", "type": "text", "promptHtml": "<div class='stem'><b>Câu 6. Chọn mệnh đề đúng nhất khi nói về tập các mối quan hệ trong mô hình quan hệ thực thể:</b></div>", "options": [], "answerIndex": null, "answerText": "Tập các mối quan hệ (relationship set) là tập hợp các quan hệ cùng kiểu giữa các thực thể của các tập thực thể tham gia; mỗi quan hệ là một bộ (tuple) các thực thể liên quan."}, {"id": 7, "section": "Lược đồ E-R", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 7: Thiết kế lược đồ quan hệ thực thể (E-R) cho CSDL về các bộ phim. Trong hệ thống này, các diễn viên tham gia đóng các bộ phim và các bộ phim được thực hiện bởi các đạo diễn. Đâu là phát biểu đúng về Thực hiện phim:</b></div>", "options": ["A. Thực hiện phim là một quan hệ giữa đạo diễn và phim", "B. Thực hiện phim là một thuộc tính của đạo diễn", "C. Thực hiện phim là một quan hệ giữa đạo diễn và diễn viên", "D. Thực hiện phim là một thực thể với các thuộc tính có thể là tên đạo diễn, tên phim"], "answerIndex": 0, "answerText": ""}, {"id": 8, "section": "Lược đồ E-R", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 8: Thiết kế lược đồ quan hệ thực thể (E-R) cho CSDL về các bộ phim. Trong hệ thống này, các diễn viên tham gia đóng các bộ phim và các bộ phim được thực hiện bởi các đạo diễn. Đâu là phát biểu đúng về Diễn viên:</b></div>", "options": ["A. Diễn viên là một thực thể với các thuộc tính có thể là id, tên, tuổi.", "B. Diễn viên là một thực thể với các thuộc tính có thể là id, tên, tuổi, vai diễn", "C. Diễn viên là một quan hệ với các thuộc tính có thể là id, tên, tuổi, phim đã đóng", "D. Diễn viên là một quan hệ với các thuộc tính có thể là id, tên, tuổi, vai diễn"], "answerIndex": 0, "answerText": ""}, {"id": 9, "section": "Mô hình dữ liệu quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 1: Khi chuyển đổi lược đồ quan hệ thực thể (E-R) sang các bảng trong mô hình quan hệ, thuộc tính của quan hệ nhiều - nhiều sẽ được chuyển thành:</b></div>", "options": ["A. Thuộc tính của thực thể tách từ quan hệ", "B. Thuộc tính của thực thể bên trái hoặc bên phải", "C. Khóa ngoại của thực thể tách từ quan hệ", "D. Khóa ngoại của thực thể bên trái hoặc bên phải."], "answerIndex": 0, "answerText": ""}, {"id": 10, "section": "Mô hình dữ liệu quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 2: Hệ thống xem phim trực tuyến có các yêu cầu về quản lý dữ liệu như sau:</b></div><div class='desc'>Các dữ liệu cần quản lý gồm phim (video), loại phim (genre), khách hàng (customer), xem phim (watch), người đánh giá (reviewer), đánh giá phim (reviews)<br>Thông tin phim: title (key), year, duration<br>Thông tin loại phim: name(key), description<br>Thông tin khách hàng: name, email(key), credit<br>Khách hàng xem phim: cần lưu ngày xem (date)<br>Reviewer là customer, có thuộc tính reputation (nổi tiếng)<br>Một review có thông tin rating, date, text. Mỗi review được xác định duy nhất bởi phim và người đánh giá.<br>Quan hệ xem giữa customer và video là quan hệ gì?</div>", "options": ["A. Many – Many", "B. Không có quan hệ", "C. One – One", "D. One – Many"], "answerIndex": 0, "answerText": ""}, {"id": 11, "section": "Mô hình dữ liệu quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 3: Hệ thống xem phim trực tuyến có các yêu cầu về quản lý dữ liệu như sau:</b></div><div class='desc'>Các dữ liệu cần quản lý gồm phim (video), loại phim (genre), khách hàng (customer), xem phim (watch), người đánh giá (reviewer), đánh giá phim (reviews)<br>Thông tin phim: title (key), year, duration<br>Thông tin loại phim: name(key), description<br>Thông tin khách hàng: name, email(key), credit<br>Khách hàng xem phim: cần lưu ngày xem (date)<br>Reviewer là customer, có thuộc tính reputation (nổi tiếng)<br>Một review có thông tin rating, date, text. Mỗi review được xác định duy nhất bởi phim và người đánh giá.<br>Quan hệ review giữa reviewer và phim là quan hệ gì?</div>", "options": ["A. Many – Many", "B. IS – A", "C. Many - One", "D. One – One"], "answerIndex": 0, "answerText": ""}, {"id": 12, "section": "Mô hình dữ liệu quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 4: Hệ thống xem phim trực tuyến có các yêu cầu về quản lý dữ liệu như sau:</b></div><div class='desc'>Các dữ liệu cần quản lý gồm phim (video), loại phim (genre), khách hàng (customer), xem phim (watch), người đánh giá (reviewer), đánh giá phim (reviews)<br>Thông tin phim: title (key), year, duration<br>Thông tin loại phim: name(key), description<br>Thông tin khách hàng: name, email(key), credit<br>Khách hàng xem phim: cần lưu ngày xem (date)<br>Reviewer là customer, có thuộc tính reputation (nổi tiếng)<br>Một review có thông tin rating, date, text. Mỗi review được xác định duy nhất bởi phim và người đánh giá.<br>Quan hệ giữa phim và loại phim là quan hệ gì?</div>", "options": ["A. Many – Many", "B. IS – A", "C. Many - One", "D. One - One"], "answerIndex": 0, "answerText": ""}, {"id": 13, "section": "Mô hình dữ liệu quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 5: Một trường ĐH xây dựng CSDL về sinh viên, các khóa học (môn học) dành cho sinh viên, các kỳ thực tập của sinh viên tại các công ty và các giảng viên của trường. Lược đồ CSDL nào là đúng đắn nhất cho hệ thống trên?</b></div>", "options": ["A. Student(sid, name, zip), Takes(sid, cid, semester), Course(cid, title, dept), Intern(sid, cid, start, end), Company(comid, name, address)", "B. Student(sid, name, zip, cid), Course(cid, title, dept), Intern(sid, cid, start, end), Company(comid, name, address)", "C. Student(sid, name, zip, cid), Takes(sid, cid, year), Course(cid, title, dept), Intern(sid, cid, company)", "D. Student(sid, name, zip, semester), Takes(sid, cid), Course(cid, title, dept), Intern(sid, cid, start, end), Company(comid, name, address)"], "answerIndex": 0, "answerText": ""}, {"id": 14, "section": "Mô hình dữ liệu quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 6: Hệ thống quản lý đào tạo trực tuyến có các yêu cầu về quản lý dữ liệu như sau: Các dữ liệu cần quản lý gồm người (person), sinh viên (student), khóa học (course), lĩnh vực (category), tham gia học (takes). Thông tin người: ssn (key), name. Thông tin học viên: học viên là 1 người có thêm thông tin year. Thông tin khóa học: cid, title. Thông tin lĩnh vực: name(key), description. Sinh viên tham gia khóa học cần lưu thông tin điểm (mark). Khi chuyển từ lược đồ E-R thành các bảng trong mô hình quan hệ, cách thể hiện nào là đúng cho quan hệ student và person?</b></div>", "options": ["A. Person(ssn, name), Student(ssn, year)", "B. Person(ssn, name), Student(sid, year, ssn)", "C. Person(ssn, name), Student(ssn, name, year)", "D. Person(ssn, name, year), Student(ssn, name)"], "answerIndex": 0, "answerText": ""}, {"id": 15, "section": "Mô hình dữ liệu quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 7: Hệ thống quản lý đào tạo trực tuyến có các yêu cầu về quản lý dữ liệu như sau: Các dữ liệu cần quản lý gồm người (person), sinh viên (student), khóa học (course), lĩnh vực (category), tham gia học (takes). Thông tin người: ssn (key), name. Thông tin học viên: học viên là 1 người có thêm thông tin year. Thông tin khóa học: cid, title. Thông tin lĩnh vực: name(key), description. Sinh viên tham gia khóa học cần lưu thông tin điểm (mark). Khi chuyển từ lược đồ E-R thành các bảng trong mô hình quan hệ, cách thể hiện nào là đúng cho quan hệ student và course?</b></div>", "options": ["A. Student(ssn, name), Course(cid, title), Takes(ssn, cid, mark)", "B. Student(ssn, name, cid, mark), Course(cid, title)", "C. Student(ssn, name), Course(cid, title, tid), Takes(tid, ssn, mark)", "D. Student(ssn, name), Course(cid, title, ssn, mark)"], "answerIndex": 0, "answerText": ""}, {"id": 16, "section": "Mô hình dữ liệu quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 8: Hệ thống quản lý đào tạo trực tuyến có các yêu cầu về quản lý dữ liệu như sau: Các dữ liệu cần quản lý gồm người (person), sinh viên (student), khóa học (course), lĩnh vực (category), tham gia học (takes). Thông tin người: ssn (key), name. Thông tin học viên: học viên là 1 người có thêm thông tin year. Thông tin khóa học: cid, title. Thông tin lĩnh vực: name(key), description. Sinh viên tham gia khóa học cần lưu thông tin điểm (mark). Khi chuyển từ lược đồ E-R thành các bảng trong mô hình quan hệ, cách thể hiện nào là đúng cho quan hệ course và category?</b></div><div class='desc'>(1 lĩnh vực thì có nhiều khóa học =&gt; quan hệ nhiều - 1)</div>", "options": ["A. Course(cid, title, cat_name), Category(name, description)", "B. Course(cid, title), Category(cid, name, description)", "C. Course(cid, title), Category(name, description), CourseCat(cid, name)", "D. Course(cid, title), Category(name, description, cid)"], "answerIndex": 0, "answerText": ""}, {"id": 17, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 1: Phát biểu nào dưới đây là sai?</b></div>", "options": ["A. Đại số quan hệ là ngôn ngữ khai báo (declarative language)", "B. SQL là ngôn ngữ khai báo (declarative language)", "C. Đại số quan hệ thực hiện truy vấn thông qua các toán tử", "C. SQL là viết tắt của Structure Query Language"], "answerIndex": 0, "answerText": ""}, {"id": 18, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 2: Phát biểu nào đúng khi nói về toán tử hợp trong ngôn ngữ truy vấn SQL?</b></div>", "options": ["A. Cấu trúc các bảng truy vấn phải giống nhau để đảm bảo tính khả hợp của các thuộc tính", "B. Hầu hết các hệ quản trị CSDL không hỗ trợ toán tử hợp", "C. Chỉ cần thực hiện phép kết nối tự nhiên sẽ cho kết quả tương đương với toán tử hợp", "D. Sử dụng phép chiếu để đảm bảo tính khả hợp của các thuộc tính."], "answerIndex": 0, "answerText": ""}, {"id": 19, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 3. Để ấn định cách xử lý khi xảy ra vi phạm ràng buộc toàn vẹn tham chiếu khi xóa hoặc sửa dữ liệu, sử dụng mệnh đề nào trong câu lệnh SQL?</b></div>", "options": ["A. ON DELETE/ON UPDATE", "B. WHEN DELETE/WHEN CHANGE", "C. ON DELETE/ON MODIFY", "D. WHEN DELETE/WHEN UPDATE"], "answerIndex": 0, "answerText": ""}, {"id": 20, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 4: So sánh với phép tích Đề các, các bản ghi là kết quả trả về của truy vấn SQL sử dụng phép JOIN là các bản ghi …</b></div>", "options": ["A. Đáp ứng các điều kiện lọc", "B. Không đáp ứng các điều kiện lọc", "C. Lồng nhau", "D. Được trừ đi"], "answerIndex": 0, "answerText": ""}, {"id": 21, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 5. CSDL về quản lý sách trong thư viện có các bảng sau:</b></div><div class='desc'>Tác giả: Author(aid, fname, lname)<br>Sách: Book(title, year, author, pages, genre, series, seriesnum)<br>(author là khóa ngoại tham chiếu đến Author.aid, genre là khóa ngoại them chiếu đến Type.name)<br>Thể loại: Type(name, description)<br>Các cuốn sách có thể được xuất bản theo series, cuốn đầu series 1, các cuốn tiếp theo series 2, 3 … Nếu sách không theo series thì trường series và seriesnum là Null.<br>Chọn câu SQL đúng cho yêu cầu truy vấn: Đếm số lượng cuốn sách ở các thể loại phổ biến nhất. Liệt kê tên thể loại, số lượng cuốn sách thuộc từng thể loại. Chỉ liệt kê các thể loại có hơn 20 cuốn sách và sắp xếp theo thứ tự giảm dần.</div>", "options": ["A. SELECT t.name, COUNT(*) as count FROM Type t, Book b WHERE t.name = b.genre GROUP BY t.name HAVING count > 20 ORDER BY count DESC;", "B. SELECT t.name, SUM(b.title) as count FROM Type t, Book b WHERE t.name = b.genre GROUP BY t.name HAVING count > 20 ORDER BY count DESC;", "C. SELECT t.name, b.title COUNT(*) as count FROM Type t, Book b GROUP BY t.name HAVING count > 20 ORDER BY count DESC;", "D. SELECT t.name, b.title COUNT(*) as count FROM Type t, Book b WHERE t.name = b.genre GROUP BY t.name, b.title HAVING count > 20 ORDER BY count DESC;"], "answerIndex": 0, "answerText": ""}, {"id": 22, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 6. CSDL về quản lý sách trong thư viện có các bảng sau:</b></div><div class='desc'>Tác giả: Author(aid, fname, lname)<br>Sách: Book(title, year, author, pages, genre, series, seriesnum)<br>(author là khóa ngoại tham chiếu đến Author.aid, genre là khóa ngoại them chiếu đến Type.name)<br>Thể loại: Type(name, description)<br>Các cuốn sách có thể được xuất bản theo series, cuốn đầu series 1, các cuốn tiếp theo series 2, 3 … Nếu sách không theo series thì trường series và seriesnum là Null.<br>Chọn câu SQL đúng cho yêu cầu truy vấn: Liệt kê tên của các series mà trong CSDL không có đủ các số của series. Chẳng hạn 1 series có 3 cuốn sách 1, 2, 3 nhưng trong CSDL chỉ có cuốn 1 và cuốn 3 (lưu ý rằng bạn không thể biết nếu bị thiếu cuốn sách cuối cùng trong series nên có thể bỏ qua trường hợp này).</div>", "options": ["A. SELECT b.series FROM Book b GROUP BY b.series HAVING COUNT(*) != MAX(b.seriesnum);", "B. SELECT b.series FROM Book b GROUP BY b.series HAVING COUNT(*) != SUM(b.seriesnum);", "C. SELECT b.series FROM Book b GROUP BY b.series HAVING COUNT(*) != b.seriesnum;", "D. SELECT b.series FROM Book b GROUP BY b.series HAVING MAX(b.seriesnum) IS NOT NULL;"], "answerIndex": 0, "answerText": ""}, {"id": 23, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 7. CSDL về quản lý sách trong thư viện có các bảng sau:</b></div><div class='desc'>Tác giả: Author(aid, fname, lname)<br>Sách: Book(title, year, author, pages, genre, series, seriesnum)<br>(author là khóa ngoại tham chiếu đến Author.aid, genre là khóa ngoại them chiếu đến Type.name)<br>Thể loại: Type(name, description)<br>Các cuốn sách có thể được xuất bản theo series, cuốn đầu series 1, các cuốn tiếp theo series 2, 3 … Nếu sách không theo series thì trường series và seriesnum là Null.<br>Chọn câu SQL đúng cho yêu cầu truy vấn: Liệt kê các cuốn sách theo thể loại ‘tech’ và là cuốn sách đầu trong series. Trả về tên sách, năm XB, tên tác giả</div>", "options": ["A. SELECT b.title, b.year, a.fname, a.lname FROM Book b, Author a WHERE b.genre = “tech” AND b.seriesnum = 1 AND b.author = a.aid;", "B. SELECT b.title, b.year, a.fname, a.lname FROM Book b JOIN Author a ON aid WHERE b.genre = “tech” AND b.seriesnum = 1;", "C. SELECT b.title, b.year, a.fname, a.lname FROM Book b, Author a, Type t WHERE b.seriesnum = 1 AND t.name = “tech”;", "D. SELECT b.title, b.year, a.fname, a.lname FROM Book b, Author a WHERE b.genre = “tech” AND b.seriesnum != NULL AND b.author = a.aid;"], "answerIndex": 0, "answerText": ""}, {"id": 24, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 8: Hệ thống mạng xã hội đơn giản có CSDL có cấu trúc như sau:</b></div><pre class='code'><code>Người dùng: User(nick, name, home_city, bio)\nFriend(nick1, nick2)\nMessage(nick, text, from_city)</code></pre><div class='desc'>Xét truy vấn SQL sau:</div><pre class='code'><code>SELECT nick, bio, min(home_city) FROM User u JOIN Message m ON u.nick = m.nick GROUP BY nick, from_city</code></pre><div class='desc'>Truy vấn trên sai ở thành phần nào?</div>", "options": ["A. bio", "B. nick", "C. from_city", "D. min(home_city)"], "answerIndex": 0, "answerText": ""}, {"id": 25, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 9: Cho một CSDL về ban nhạc với các bảng như sau:</b></div><pre class='code'><code>Ban nhạc: Band(bid, name, genre)\nThành viên: Members(mid, yearJoined, name, position, bid)</code></pre><div class='desc'>(bid là khóa ngoại tham chiếu đến Band.bid)</div><pre class='code'><code>Album: Albums(aid, name, year, bid)</code></pre><div class='desc'>(bid là khóa ngoại tham chiếu đến Band.bid)</div><pre class='code'><code>Tua diễn: Tours(bid, year, location)</code></pre><div class='desc'>(bid là khóa ngoại tham chiếu đến Band.bid)</div><pre class='code'><code>Chơi trong band: PlaysIn(aid, mid)</code></pre><div class='desc'>(thành viên mid chơi trong album aid, trong đó aid, mid là khóa ngoại)<br>Chọn câu SQL đúng cho yêu cầu truy vấn: Liệt kê danh sách các thành viên (thông tin gồm mid, name) và số lần mỗi người đã biểu diễn tại Hà Nội, cùng với tên band nhạc mà người đó là thành viên. Nếu người đó là thành viên nhiều band nhạc thì liệt kê nhiều kết quả, mỗi kết quả là số lần chơi trong mỗi band.</div>", "options": ["A. SELECT m.mid, m.name, count(*) AS numPlays, b.name FROM Members m, Band b, Tours t WHERE m.bid = t.bid AND t.location = ‘Hà Nội’ AND m.yearJoined < t.year GROUP BY m.mid, m.name, b.name", "B. SELECT m.mid, m.name, count(*) AS numPlays, b.name FROM Members m, Band b, Tours t WHERE m.bid = b.bid AND t.bid = b.bid AND t.location = ‘Hà Nội’ AND m.yearJoined < t.year GROUP BY m.mid, m.name", "C. SELECT m.mid, m.name, count(*) AS numPlays, b.bid, b.name FROM Members m, Band b, Tours t WHERE m.bid = b.bid AND t.bid = b.bid AND t.location = ‘Hà Nội’ AND m.yearJoined < t.year GROUP BY m.mid, m.name, b.name", "D. SELECT m.mid, m.name, count(*) AS numPlays, b.name FROM Members m, Tours t WHERE t.bid = m.bid AND t.location = ‘Hà Nội’ AND m.yearJoined < t.year GROUP BY m.mid, m.name, b.name"], "answerIndex": 0, "answerText": ""}, {"id": 26, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "text", "promptHtml": "<div class='stem'><b>Câu 10. CSDL về các bộ phim có cấu trúc như sau:</b></div><pre class='code'><code>ACTOR(pid, fname, lname, gender)\nMOVIE(mid, name, year, revenue)\nDIRECTORS(did, fname, Iname)\nCAST(pid, mid, role)</code></pre><div class='desc'>MOVIE_DIRECTORS(did, mid)<br>Câu lệnh truy vấn SQL nào là đúng khi tìm các bộ phim có doanh thu cao hơn bộ phim có doanh thu (revenue) cao nhất năm 2000 (các bộ phim này có thể là bất kỳ năm nào). Trả về tên phim và doanh thu của nó.</div>", "options": [], "answerIndex": null, "answerText": "SELECT m1.name, m1.revenue\nFROM Movie m1\nWHERE m1.revenue > ALL (SELECT MAX(m2.revenue)\n                        FROM Movie m2 \n                        WHERE m2.year = 2000)"}, {"id": 27, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 11. CSDL về các bộ phim có cấu trúc như sau:</b></div><pre class='code'><code>ACTOR(pid, fname, lname, gender)\nMOVIE(mid, name, year, revenue)\nDIRECTORS(did, fname, Iname)\nCAST(pid, mid, role)</code></pre><div class='desc'>MOVIE_DIRECTORS(did, mid)<br>Câu lệnh truy vấn SQL nào là đúng khi muốn tìm các cặp diễn viên cùng đóng trong ít nhất 2 bộ phim. Trả về id của các diễn viên và số lần họ cùng đóng trong một bộ phim.</div>", "options": ["A. SELECT c1.pid, c2.pid COUNT(*) AS c FROM Movie m, Cast c1, Cast c2 WHERE m.mid = c1.mid AND m.mid = c2.mid AND c1.pid != c2.pid GROUP BY c1.pid, c2.pid HAVING COUNT(*) >=2", "B. SELECT c.pid AS pid1, c.pid AS pid2, COUNT(*) AS num FROM Movie m, Cast c WHERE m.mid = c.mid AND c.pid1 != c.pid2 GROUP BY c.pid1, c.pid2 HAVING COUNT(*) >=2", "C. SELECT c1.pid, c2.pid COUNT(*) AS c FROM Movie m, Cast c1, Cast c2 WHERE m.mid = c1.mid AND m.mid = c2.mid GROUP BY c1.pid, c2.pid HAVING COUNT(*) >=2", "D. SELECT c1.pid, c2.pid COUNT(*) AS c FROM Movie m, Cast c1, Cast c2 WHERE m.mid = c1.mid AND m.mid = c2.mid AND COUNT(*) >=2 GROUP BY c1.pid, c2.pid"], "answerIndex": 0, "answerText": ""}, {"id": 28, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 12. Cho hai bảng Users(UserId, Username) và ClassUsers(Classid, UserID), câu lệnh nào liệt kê tất cả các sinh viên đã nhập học?</b></div>", "options": ["A. SELECT U.* FROM Users U INNER JOIN ClassUsers CU ON U.UserID = CU.UserID", "B. SELECT Users.* FROM Users U INNER JOIN ClassUsers CU ON U.UserID = CU.UserID", "C. SELECT * FROM Users U INNER JOIN ClassUsers CU ON U.UserID = CU.UserID", "D. SELECT Users.* FROM Users U INNER JOIN ClassUsers CU ON Users.UserID = ClassUsers.UserID"], "answerIndex": 0, "answerText": ""}, {"id": 29, "section": "Ngôn ngữ truy vấn cấu trúc SQL", "type": "text", "promptHtml": "<div class='stem'><b>Câu 13. Hệ thống blog online đơn giản có CSDL có cấu trúc như sau:</b></div><div class='desc'>Người dùng: Users(uid, uname, city)<br>Blog: Blog(bid, author, size, pdf)<br>(author là khóa ngoại tham chiếu đến uid từ bảng Users)<br>Viết một truy vấn SQL trả về tất cả người dùng đã đăng cả một blog lớn hơn 1MB (size &gt; 1000000) và một blog nhỏ hơn 1MB.</div>", "options": [], "answerIndex": null, "answerText": "SELECT u.uid, u.uname FROM Users u, Blog b1, Blog b2 WHERE u.uid = b1.author and u.uid = b2.author and b1.size > 1000000 and b2.size <= 1000000"}, {"id": 30, "section": "Đại số quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 1: Với toán tử select của đại số quan hệ, ____ xuất hiện trong chỉ số dưới (subscript) và tên ____ xuất hiện trong cặp ngoặc sau ký hiệu sigma.</b></div>", "options": ["A. Mệnh đề, quan hệ", "B. Quan hệ, Mệnh đề", "C. Quan hệ, Phép toán", "D. Phép toán, Mệnh đề"], "answerIndex": 0, "answerText": ""}, {"id": 31, "section": "Đại số quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 2: Phép toán nào được sử dụng khi chỉ quan tâm tới một số cột trong bảng?</b></div>", "options": ["A. Phép chiếu", "B. Phép hợp", "C. Phép kết nối", "D. Phép chọn"], "answerIndex": 0, "answerText": ""}, {"id": 32, "section": "Đại số quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 3: Trong đại số quan hệ, các truy vấn được thực hiện thông qua ___</b></div>", "options": ["A. Các toán tử", "B. Các đối tượng", "C. Các quan hệ", "D. Các thực thể"], "answerIndex": 0, "answerText": ""}, {"id": 33, "section": "Đại số quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 4: Biểu thức đại số quan hệ sau sẽ trả về kết quả gì (PR: Projection)(PRcustomer_name, loan_number, amount (borrower ⋈loan)</b></div>", "options": ["A. Nó tìm customer_name, loan_number và amount từ phép kết nối tự nhiên (natural join) của borrower và loan", "B. Nó tìm customer_name, loan_number và amount từ loan", "C. Nó tìm customer_name, loan_number và amount từ borrower", "D. Nó tìm customer_name, loan_number và amount từ phép kế nối ngoài đầy đủ (full outer join) của borrower và loan"], "answerIndex": 0, "answerText": ""}, {"id": 34, "section": "Đại số quan hệ", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 5: Hệ thống mạng xã hội đơn giản có CSDL có cấu trúc như sau:</b></div><pre class='code'><code>Người dùng: User(nick, name, home_city, bio)\nFriend(nick1, nick2)\nMessage(nick, text, from_city)\nBiểu thức đại số quan hệ đúng theo yêu cầu truy vấn dưới là gì (DE = Duplicate Elimination, PR=Projection, SL=Selection, IN=Intersection, - = Difference)?</code></pre><div class='desc'>Tìm nick của những người dùng đã đăng các bài tại các thành phố khác với thành phố họ sinh sống.</div>", "options": ["A. DE ( PR nick [ ( PR nick, from_city Message) -  (PR nick, home_city User) ])", "B. DE ( PR nick [ ( PR nick, from_city (SL home_city <> from_city User)) ])", "C. DE ( PR nick [ ( PR nick, from_city (SL home_city <> from_city Message)) ])", "D. DE ( PR nick [ ( PR nick, from_city Message) IN  (PR nick, home_city User) ])"], "answerIndex": 0, "answerText": ""}, {"id": 35, "section": "Phụ thuộc hàm, chuẩn hóa", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 1: Cột A trong bảng của lược đồ quan hệ R(A, B, C) chỉ nhận những giá trị phân biệt bao gồm cả giá trị NULL phát biểu nào đúng?</b></div>", "options": ["A. A không phải là khóa dự tuyển.", "B. A là khóa dự tuyển", "C. A là khóa phụ", "D. A là khóa chính"], "answerIndex": 0, "answerText": ""}, {"id": 36, "section": "Phụ thuộc hàm, chuẩn hóa", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 2: Cho quan hệ R(A, B, C, D, E, F) và các phụ thuộc hàm A -&gt; BC, C-&gt; AB, CE-&gt; AD. Kết quả của phép tách quan hệ R ra các quan hệ theo chuẩn BCNF theo phụ thuộc hàm C -&gt; AB trước là các quan hệ nào dưới đây?</b></div>", "options": ["A. R1(ABC), R21(CDE), R22(CEF)", "B. R1(ABC), R21(CE), R22(CDF)", "C. R1(CAB), R2(CDEF)", "D. R1(CAB), R21(CD), R22(CDF)"], "answerIndex": 2, "answerText": ""}, {"id": 37, "section": "Phụ thuộc hàm, chuẩn hóa", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 3: Cho quan hệ R(A, B, C, D, E) và các phụ thuộc hàm: A -&gt; C, BD -&gt; A, D -&gt; E. Tách R thành các quan hệ theo chuẩn BCNF bắt đầu từ phụ thuộc hàm A -&gt; C có kết quả là?</b></div>", "options": ["A. R1(A, C), R2(B, D, A), R3(D, E)", "B. R1(A, C), R2(D, A, B), R3(D, E)", "C. R1(A, C), R2(B, D), R3(D, E, A)", "D. R1(AC), R2(ABDE)"], "answerIndex": 0, "answerText": ""}, {"id": 38, "section": "Phụ thuộc hàm, chuẩn hóa", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 4: Cho quan hệ R(A, B, C, D, E) và các phụ thuộc hàm: A -&gt; C, BD -&gt; A, D -&gt; E. Bao đóng của {BD} là?</b></div><div class='desc'>Bài làm<br>V1: {BDAE}<br>V2: {BDAEC}</div>", "options": ["A. {ABCDE}", "B. {ABDE}", "C. {ACBD}", "D. {ABD}"], "answerIndex": 0, "answerText": ""}, {"id": 39, "section": "Phụ thuộc hàm, chuẩn hóa", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 5: Cho quan hệ R(A, B, C, D, E, F) và các phụ thuộc hàm: A -&gt; CDE, F -&gt; ABD, D -&gt; E. Bao đóng của AB{AB+} là?</b></div>", "options": ["A. {ABCDE}", "B. {ABC}", "C. {ABDE}", "D. {ABCD}"], "answerIndex": 0, "answerText": ""}, {"id": 40, "section": "Phụ thuộc hàm, chuẩn hóa", "type": "mcq", "promptHtml": "<div class='stem'><b>Câu 6: Cho quan hệ R(A, B, C, D, E, F) và các phụ thuộc hàm: A -&gt; CDE, F -&gt; ABD, D -&gt; E. Bao đóng của AB{F+} là?</b></div>", "options": ["A. {ABCDEF}", "B. {ABDF}", "C. {ABDCE}", "D. {FABDC}"], "answerIndex": 0, "answerText": ""}];

function norm(s) {
  return (s || "")
    .toLowerCase()
    .replace(/[“”]/g,'"')
    .replace(/[‘’]/g,"'")
    .replace(/\s+/g,"")
    .replace(/;+/g,"")
    .trim();
}

function keywordScore(ans, keywords) {
  const low = (ans || "").toLowerCase();
  let hit = 0;
  for (const k of keywords) {
    if (low.includes(k)) hit++;
  }
  return hit;
}

function render() {
  const root = document.getElementById("root");
  root.innerHTML = "";
  const filter = document.getElementById("sectionFilter").value;

  for (const q of QUESTIONS) {
    if (filter !== "__all__" && q.section !== filter) continue;

    const div = document.createElement("div");
    div.className = "q";
    div.dataset.qid = q.id;
    div.dataset.section = q.section;

    div.innerHTML = `
      <div class="qhead">
        <div class="qid">#${q.id}</div>
        <div class="sectionTag">${q.section || ""}</div>
      </div>
      <div class="qbody">${q.promptHtml}</div>
      <div class="opts" id="opts-${q.id}"></div>
      <div class="actions">
        <button class="checkBtn" data-qid="${q.id}">Kiểm tra câu này</button>
        <button class="showBtn" data-qid="${q.id}">Hiện đáp án</button>
      </div>
      <div class="fb" id="fb-${q.id}"></div>
    `;

    const opts = div.querySelector(`#opts-${q.id}`);

    if (q.type === "mcq") {
      q.options.forEach((op, i) => {
        const label = document.createElement("label");
        label.innerHTML = `<input type="radio" name="q${q.id}" value="${i}"> ${op}`;
        opts.appendChild(label);
      });
    } else {
      const ta = document.createElement("textarea");
      ta.placeholder = "Nhập câu trả lời (hoặc dán SQL) ở đây...";
      ta.id = `txt-${q.id}`;
      opts.appendChild(ta);

      if (q.answerText) {
        const hint = document.createElement("div");
        hint.className = "desc";
        hint.innerHTML = "Câu này chấm theo “đáp án mẫu” (so khớp gần đúng/chuẩn hoá).";
        opts.appendChild(hint);
      }
    }

    root.appendChild(div);
  }

  document.querySelectorAll(".checkBtn").forEach(btn => {
    btn.onclick = () => gradeOne(Number(btn.dataset.qid));
  });
  document.querySelectorAll(".showBtn").forEach(btn => {
    btn.onclick = () => showAnswer(Number(btn.dataset.qid));
  });
}

function getQuestion(qid) {
  return QUESTIONS.find(q => q.id === qid);
}

function setBoxState(qid, ok) {
  const box = document.querySelector(`.q[data-qid="${qid}"]`);
  box.classList.remove("right","wrong");
  if (ok === true) box.classList.add("right");
  if (ok === false) box.classList.add("wrong");
}

function letter(i) {
  return ["A","B","C","D"][i] ?? "?";
}

function showAnswer(qid) {
  const q = getQuestion(qid);
  const fb = document.getElementById(`fb-${qid}`);
  if (q.type === "mcq") {
    if (q.answerIndex == null) {
      fb.innerHTML = `<span class="bad">Không có đáp án khóa cho câu này trong file.</span>`;
      return;
    }
    const ansText = q.options[q.answerIndex];
    fb.innerHTML = `<span class="good">Đáp án: ${letter(q.answerIndex)}.</span> ${ansText}`;
  } else {
    fb.innerHTML = `<div class="good"><b>Đáp án mẫu:</b></div><pre class="code"><code>${escapeHtml(q.answerText || "(chưa có)")}</code></pre>`;
  }
}

function escapeHtml(s) {
  return (s || "")
    .replaceAll("&","&amp;")
    .replaceAll("<","&lt;")
    .replaceAll(">","&gt;")
    .replaceAll('"',"&quot;")
    .replaceAll("'","&#039;");
}

function gradeOne(qid) {
  const q = getQuestion(qid);
  const fb = document.getElementById(`fb-${qid}`);

  if (q.type === "mcq") {
    const picked = document.querySelector(`input[name="q${qid}"]:checked`);
    if (!picked) {
      setBoxState(qid, null);
      fb.innerHTML = `<span class="bad">Bạn chưa chọn đáp án.</span>`;
      return {done:false, correct:false};
    }
    if (q.answerIndex == null) {
      setBoxState(qid, null);
      fb.innerHTML = `<span class="bad">Câu này không có đáp án khóa trong file.</span>`;
      return {done:true, correct:false};
    }
    const val = Number(picked.value);
    const ok = val === q.answerIndex;
    setBoxState(qid, ok);
    if (ok) fb.innerHTML = `<span class="good">✅ Đúng!</span>`;
    else fb.innerHTML = `<span class="bad">❌ Sai.</span> Đáp án đúng: <b>${letter(q.answerIndex)}.</b> ${q.options[q.answerIndex]}`;
    return {done:true, correct:ok};
  } else {
    const txt = document.getElementById(`txt-${qid}`).value || "";
    const ans = q.answerText || "";
    if (!txt.trim()) {
      setBoxState(qid, null);
      fb.innerHTML = `<span class="bad">Bạn chưa nhập câu trả lời.</span>`;
      return {done:false, correct:false};
    }

    let ok = false;
    const n1 = norm(txt);
    const n2 = norm(ans);

    if (n2.length > 0 && (ans.includes("SELECT") || ans.includes("select"))) {
      ok = (n1 === n2);
    } else {
      const keywords = ["tập", "quan hệ", "kiểu", "thực thể", "tập hợp"];
      ok = keywordScore(txt, keywords) >= 3;
    }

    setBoxState(qid, ok);
    if (ok) fb.innerHTML = `<span class="good">✅ Đúng (khớp đáp án mẫu).</span>`;
    else fb.innerHTML = `<span class="bad">❌ Chưa khớp đáp án mẫu.</span> Bạn có thể bấm “Hiện đáp án” để xem.`;
    return {done:true, correct:ok};
  }
}

function gradeAll() {
  const filter = document.getElementById("sectionFilter").value;
  let done = 0, correct = 0;
  for (const q of QUESTIONS) {
    if (filter !== "__all__" && q.section !== filter) continue;
    const res = gradeOne(q.id);
    if (res.done) {
      done++;
      if (res.correct) correct++;
    }
  }
  document.getElementById("scoreBox").textContent = `Điểm: ${correct}/${done}`;
}

function resetAll() {
  const filter = document.getElementById("sectionFilter").value;
  document.querySelectorAll(".q").forEach(box => {
    if (filter !== "__all__" && box.dataset.section !== filter) return;
    box.classList.remove("right","wrong");
    const qid = Number(box.dataset.qid);
    const q = getQuestion(qid);
    document.getElementById(`fb-${qid}`).innerHTML = "";
    if (q.type === "mcq") {
      box.querySelectorAll(`input[name="q${qid}"]`).forEach(r => r.checked = false);
    } else {
      const ta = document.getElementById(`txt-${qid}`);
      if (ta) ta.value = "";
    }
  });
  document.getElementById("scoreBox").textContent = "Điểm: 0/0";
}

document.getElementById("gradeAll").onclick = gradeAll;
document.getElementById("resetAll").onclick = resetAll;
document.getElementById("sectionFilter").onchange = () => {
  render();
  document.getElementById("scoreBox").textContent = "Điểm: 0/0";
};

render();
</script>
</body>
</html>
